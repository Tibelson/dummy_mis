<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lecturer Portal - MIS Web</title>
      <link href="./dist/output.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="styles.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
  <nav class="bg-white shadow-lg border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
      <a href="home.html" class="text-gray-700 hover:text-blue-600 font-semibold">Home</a>
      <div class="space-x-4">
        <a href="#" class="nav-link" onclick="showSection('dashboard')">Dashboard</a>
        <a href="#" class="nav-link" onclick="showSection('courses')">My Courses</a>
        <a href="#" class="nav-link" onclick="showSection('students')">Students</a>
        <a href="#" class="nav-link" onclick="showSection('grades')">Grades</a>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-6 py-8">
    <section id="dashboard" class="section">
      <h1 class="text-3xl font-bold text-gray-900 mb-4">Lecturer Dashboard</h1>
      <div class="grid grid-cols-3 gap-6">
        <div class="card"><p class="card-title">Courses</p><p id="statCourses" class="text-2xl font-bold">-</p></div>
        <div class="card"><p class="card-title">Students</p><p id="statStudents" class="text-2xl font-bold">-</p></div>
        <div class="card"><p class="card-title">Pending Grades</p><p id="statPending" class="text-2xl font-bold">-</p></div>
      </div>
    </section>

    <section id="courses" class="section hidden">
      <h2 class="text-2xl font-semibold mb-4">My Courses</h2>
      <div id="myCoursesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <section id="students" class="section hidden">
      <h2 class="text-2xl font-semibold mb-4">Students</h2>
      <div id="studentsList" class="space-y-3"></div>
    </section>

    <section id="grades" class="section hidden">
      <div class="flex items-center gap-4 mb-4">
        <select id="gradeCourseSelect" class="form-select w-80">
          <option value="">Select Course</option>
        </select>
      </div>
      <div id="gradeArea" class="bg-white rounded shadow p-6">
        <p class="text-gray-500">Select a course to manage grades</p>
      </div>
    </section>
  </main>

      <script src="api.js"></script>
    <script>
        // Check authentication
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        const userRole = localStorage.getItem('userRole');
        
        if (!userRole || userRole !== 'LECTURER') {
            alert('Access denied. Please login as a lecturer.');
            window.location.href = 'login.html';
        }
        
        const state = { lecturerId: user.lecturerId, courses: [] };

    function hideAll(){ document.querySelectorAll('.section').forEach(s=>s.classList.add('hidden')); }
    function showSection(id){ hideAll(); document.getElementById(id).classList.remove('hidden'); }

    async function init(){
      const user = JSON.parse(localStorage.getItem('user')||'null');
      state.lecturerId = user?.id || 1;

      state.courses = await api.getLecturerCourses(state.lecturerId).catch(()=>[]);

      // Stats
      document.getElementById('statCourses').textContent = state.courses.length;
      const totalStudents = state.courses.reduce((s,c)=>s + (c.enrollments?.length||0), 0);
      document.getElementById('statStudents').textContent = totalStudents;
      const pending = state.courses.reduce((s,c)=> s + (c.enrollments?.filter(e=>!e.grade)?.length||0), 0);
      document.getElementById('statPending').textContent = pending;

      // Courses grid
      document.getElementById('myCoursesGrid').innerHTML = state.courses.map(c=>`<div class="bg-white rounded shadow p-5">
        <div class="flex justify-between mb-2">
          <div class="font-semibold">${c.courseTitle}</div>
          <button class="btn-primary" onclick="openGrades(${c.id})"><i class="fas fa-graduation-cap mr-2"></i>Manage Grades</button>
        </div>
        <div class="text-sm text-gray-600">${c.courseCode} • ${c.credits} credits</div>
        <div class="text-sm">${c.enrollments?.length||0} students</div>
      </div>`).join('');

      // Students list
      const all = [];
      state.courses.forEach(c => (c.enrollments||[]).forEach(e => e.student && all.push({course:c, enrollment:e, student:e.student})));
      document.getElementById('studentsList').innerHTML = all.map(x=>`<div class="bg-white rounded shadow p-4">
        <div class="flex justify-between">
          <div>
            <div class="font-medium">${x.student.firstName} ${x.student.lastName}</div>
            <div class="text-sm text-gray-600">${x.student.email} • ${x.student.admissionNumber}</div>
          </div>
          <div class="text-sm">${x.course.courseCode}</div>
        </div>
      </div>`).join('');

      // Grade select
      const select = document.getElementById('gradeCourseSelect');
      select.innerHTML = '<option value="">Select Course</option>' + state.courses.map(c=>`<option value="${c.id}">${c.courseCode} - ${c.courseTitle}</option>`).join('');
      select.onchange = ()=> openGrades(select.value);
    }

    function openGrades(courseId){
      if(!courseId) return;
      const c = state.courses.find(x=>x.id==courseId);
      if(!c){ return; }
      showSection('grades');
      const area = document.getElementById('gradeArea');
      area.innerHTML = (c.enrollments||[]).map(e=>`<div class="flex items-center justify-between border-b py-3">
        <div>
          <div class="font-medium">${e.student?.firstName||''} ${e.student?.lastName||''}</div>
          <div class="text-sm text-gray-600">${e.student?.admissionNumber||''}</div>
        </div>
        <div class="flex items-center gap-2">
          <select id="grade_${e.id}" class="form-select">
            ${['A','B','C','D','F'].map(g=>`<option ${e.grade===g?'selected':''}>${g}</option>`).join('')}
          </select>
          <button class="btn-primary" onclick="saveGrade(${e.id})">Save</button>
        </div>
      </div>`).join('') || '<p class="text-gray-500">No students enrolled</p>';
    }

    async function saveGrade(enrollmentId){
      const select = document.getElementById(`grade_${enrollmentId}`);
      const grade = select.value;
      try{
        await api.assignGrade(enrollmentId, grade);
        alert('Grade saved successfully');
        // Refresh the grade area
        openGrades(document.getElementById('gradeCourseSelect').value);
      }catch(err){ 
        alert('Failed to save grade: ' + err.message); 
      }
    }

    init();
  </script>
</body>
</html> 